<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <!-- <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> -->
    <title>Hello, world!</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            margin: 0px;
            padding: 0px;
            font-family: Arial;
        }

        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        /* Firefox */
            input[type=number] {
            -moz-appearance: textfield;
        }

        .orderMainBlock{
            padding: 24px;
            background-color: #eee;
            min-height: 100vh;
        }

        .billBlock , .productBlock {
            background-color: white;
        }

        .productBlock {
            margin-top: 24px;
            padding: 24px;
            overflow-x: auto;
        }

        .blockLabel {
            font-weight: bold;
            margin: 0;
           /* font-display: Arial !important; */
        }

        .grid-container {
            display: grid;
            grid-column-gap: 50px;
            grid-template-columns: auto auto auto;
            padding: 10px;
        }

        .grid-item {
            padding: 20px;
            font-size: 30px;
            text-align: left;
        }

        .inputFormFields input , .productBlock input {
            display: block;
            width: 100%;
            padding:5px 0 5px 5px;
            margin: 12px 0;
            border:1px solid #ddd;
            font-size: 15px;
            line-height: 17px;
            border-radius: 2px;  
        }

        

        .dateInput , textarea{
            padding:5px 0 5px 5px;
            margin: 12px 0;
            border:1px solid #eee;
            font-size: 15px;
            line-height: 17px;
            border-radius: 2px;  
        }

        #bdate, #sdate{
            background: url('calendar.svg') no-repeat;
            background-position-x: 98%;
            background-position-y: center;
        }

        table{
            text-align: left;
        }

        .button {
            text-transform: uppercase;
            font-size: 14px;
            line-height: 16px;
            background-color: #4a90e2;
            color:white;
            padding: 8px;
            border-radius: 4px;
            border:none;
        }

        .delBtn {
            background-color: red;
        }
        

        .totalPrice {
            background-color: #eee;
            padding: 5px 0 5px 5px;
        }

        .errorClass {
            border: 1px solid red;
            text-align: center;
            width: 40%;
            margin: 0 auto;
        }

        

        @media (min-width: 320px) and (max-width:480px) {
            .grid-container {
                grid-template-columns: auto;
            }
        }
    </style>
</head>
<body  onload="onLoad()">
    <div class="orderMainBlock">
        <div class="billBlock">
            <div class="grid-container">
                <div class="grid-item">
                    <h5 class="blockLabel">
                        Billing Address
                    </h5>

                    <form class="inputFormFields">
                        <input type="text" id="bfname"  placeholder="First Name">
                        <input type="text" id="blname"  placeholder="Last Name">
                        <input type="text" id="baddr1"  placeholder="Address Line 1">
                        <input type="text" id="baddr2"  placeholder="Address Line 2">
                        <input type="text" id="bcity"   placeholder="City">
                        <input type="text" id="bstate"  placeholder="State">
                        <input type="number" id="bzipcode" placeholder="Zip Code">
                        <input type="text" id="bcountry" placeholder="Country">
                    </form>

                    <h5 class="blockLabel">
                        Order Date
                    </h5>
                    <input class="dateInput" type="date" id="bdate" placeholder="dd/mm/yyyy" required>
                    
                </div>
                <div class="grid-item">

                    <h5 class="blockLabel">
                        Shipping Address
                    </h5>
                    
                    <form class="inputFormFields">
                        <input type="text" id="sfname" placeholder="First Name">
                        <input type="text" id="slname" placeholder="Last Name">
                        <input type="text" id="saddr1" placeholder="Address Line 1">
                        <input type="text" id="saddr2" placeholder="Address Line 2">
                        <input type="text" id="scity" placeholder="City">
                        <input type="text" id="sstate" placeholder="State">
                        <input type="number" id="szipcode" placeholder="Zip Code">
                        <input type="text" id="scountry" placeholder="Country">
                    </form>
                    
                    <h5 class="blockLabel">
                        Order Date
                    </h5>
                    <input class="dateInput" type="date" id="sdate" placeholder="dd/mm/yyyy">
                </div>
               
            </div>


        </div>

        <div class="productBlock">
            <table id="myTable" cellspacing="10">

            </table>
            <button class="button" value="Add Product" onclick="addField();">Add Product</button>

            <br>
            <div style="text-align:right">
                <button class="button" type="submit" onclick="submitProducts();">SAVE</button>
            </div>
            
        <div id="uniqueId"></div>
        </div>
        

    </div>
</body>
<script>
    var jsonData = {};
    function generateJSON(){

    var data = {
        addressInfo: {
            billing_address:{},
            shipping_address:{}
        },
        orderInfo : {},
        productInfo    : []
    
    };  

    //GENERATE ADDRESS DATA

    data.addressInfo.billing_address.firstName= document.getElementById('bfname').value;
    data.addressInfo.billing_address.lastName= document.getElementById('blname').value;
    data.addressInfo.billing_address.addressLine1= document.getElementById('baddr1').value;
    data.addressInfo.billing_address.addressLine2= document.getElementById('baddr2').value;
    data.addressInfo.billing_address.city= document.getElementById('bcity').value;
    data.addressInfo.billing_address.country= document.getElementById('bstate').value;
    data.addressInfo.billing_address.zipcode= document.getElementById('bzipcode').value;
    data.addressInfo.billing_address.state= document.getElementById('bcountry').value;

    data.addressInfo.shipping_address.firstName= document.getElementById('sfname').value;
    data.addressInfo.shipping_address.lastName= document.getElementById('slname').value;
    data.addressInfo.shipping_address.addressLine1= document.getElementById('saddr1').value;
    data.addressInfo.shipping_address.addressLine2= document.getElementById('saddr2').value;
    data.addressInfo.shipping_address.city= document.getElementById('scity').value;
    data.addressInfo.shipping_address.country= document.getElementById('sstate').value;
    data.addressInfo.shipping_address.zipcode= document.getElementById('szipcode').value;
    data.addressInfo.shipping_address.state= document.getElementById('scountry').value;


    //GENERATE ORDER DATA

    data.orderInfo.orderDate=document.getElementById('bdate').value;
    data.orderInfo.deliveryDate=document.getElementById('sdate').value;

    //GENERATE PRODUCT DATA

            var myTable = document.getElementById("myTable");
            var currentIndex = myTable.rows.length-1; 
            console.log(currentIndex);

     //console.log(myTable.rows[1].cells[0].getElementsByTagName("input")[0].value);
     for(var i=1;i<=currentIndex;i++){
        //console.log(JSON.stringify(data));
        
        data.productInfo.push({
        productId :myTable.rows[i].cells[0].getElementsByTagName("input")[0].value,
        productName:myTable.rows[i].cells[1].getElementsByTagName("input")[0].value,
        unitPrice:myTable.rows[i].cells[2].getElementsByTagName("input")[0].value,
        productCount:myTable.rows[i].cells[3].getElementsByTagName("input")[0].value,
        totalPrice:myTable.rows[i].cells[4].getElementsByTagName("input")[0].value,
        notes:myTable.rows[i].cells[5].getElementsByTagName("textarea")[0].value,
});

        
        

     }       


    console.log(JSON.stringify(data));

    }

   
    function addField(argument) {
            var myTable = document.getElementById("myTable");
            var currentIndex = myTable.rows.length;
            var currentRow = myTable.insertRow(-1);

            var productIdBlock = document.createElement("input");
            productIdBlock.setAttribute("name", "productId" + currentIndex);
            productIdBlock.setAttribute("type", "number");
            productIdBlock.setAttribute("id", "productId" + currentIndex);
            productIdBlock.setAttribute("required", "required");
           

            var productNameBlock = document.createElement("input");
            productNameBlock.setAttribute("name", "productName" + currentIndex);
            productNameBlock.setAttribute("type", "text");
            productNameBlock.setAttribute("id", "productName" + currentIndex);
            productNameBlock.setAttribute("required", "required");

            var productQty = document.createElement("input");
            productQty.setAttribute("name", "productQty" + currentIndex);
            productQty.setAttribute("type", "number");
            productQty.setAttribute("value", 0);
            productQty.setAttribute("id", 'countApple'+currentIndex);
            productQty.setAttribute("required", "required");
        

            var productUnitPrice = document.createElement("input");
            productUnitPrice.setAttribute("name", "productUnitPrice" + currentIndex);
            productUnitPrice.setAttribute("type", "number");
            productUnitPrice.setAttribute("value", 0);
            productUnitPrice.setAttribute("id", 'Apple'+currentIndex);
            productUnitPrice.setAttribute("required", "required");
           

            var productTotalPrice = document.createElement("input");
            productTotalPrice.setAttribute("name", "productTotalPrice" + currentIndex);
            productTotalPrice.setAttribute("readonly", true);
            productTotalPrice.setAttribute("id", 'totalPrice'+currentIndex);
            productTotalPrice.setAttribute("value", 0000);
            productTotalPrice.setAttribute("class", "totalPrice");


            var productNotes = document.createElement("textarea");
            productNotes.setAttribute("name", "productNote" + currentIndex);
            
            var deleteProducBox = document.createElement("input");
            deleteProducBox.setAttribute("type", "button");
            deleteProducBox.setAttribute("value", "DELETE");
            deleteProducBox.setAttribute("onclick", "deleteProduct(this);");
            deleteProducBox.setAttribute("class", "button delBtn");

            var currentCell = currentRow.insertCell(-1);
            currentCell.appendChild(productIdBlock);

            currentCell = currentRow.insertCell(-1);
            currentCell.appendChild(productNameBlock);

           

            currentCell = currentRow.insertCell(-1);
            currentCell.appendChild(productUnitPrice);

             currentCell = currentRow.insertCell(-1);
            currentCell.appendChild(productQty);

            currentCell = currentRow.insertCell(-1);
            currentCell.appendChild(productTotalPrice);

            currentCell = currentRow.insertCell(-1);
            currentCell.appendChild(productNotes);

            currentCell = currentRow.insertCell(-1);
            currentCell.appendChild(deleteProducBox);

        
            
            productQty.setAttribute("onchange", "calculatePrice(this.value,document.getElementById('"+"Apple"+currentIndex+"').value,totalPrice"+currentIndex+")");            
            productUnitPrice.setAttribute("onchange", "calculatePrice(this.value,document.getElementById('"+"countApple"+currentIndex+"').value,totalPrice"+currentIndex + ")");
        }

    function deleteProduct(o) {
            var p = o.parentNode.parentNode;
            p.parentNode.removeChild(p);
        }    


    function onLoad() {
         fetch("https://raw.githubusercontent.com/priyankakekane/OrderAssgn/master/response.json")
             .then(response => response.json())
             .then((json)=>{
                 CreateTableFromJSON(json);
             });

        
    }     

    function CreateTableFromJSON(json) {
        var billDetails;
        var shippingDetails;
        var productDetails;

        billDetails = json.addressInfo.billing_address;
        productDetails = json.productInfo;
        shippingDetails = json.addressInfo.shipping_address;
        populateBillingAddress(billDetails);
        populateShippingAddress(shippingDetails);
        
        document.getElementById('myTable').innerHTML = populateProductTable(productDetails, 'table');

    }


    function populateBillingAddress(billObject) {
        
        document.getElementById("bfname").value = billObject.firstName;
        document.getElementById("blname").value = billObject.lastName;
        document.getElementById("baddr1").value = billObject.addressLine1;
        document.getElementById("baddr2").value = billObject.addressLine2;
        document.getElementById("bcity").value = billObject.city;
        document.getElementById("bstate").value = billObject.state;
        document.getElementById("bzipcode").value = billObject.zipcode;
        document.getElementById("bcountry").value = billObject.country;
    }

    function populateShippingAddress(billObject) {
            
            document.getElementById("sfname").value = billObject.firstName;
            document.getElementById("slname").value = billObject.lastName;
            document.getElementById("saddr1").value = billObject.addressLine1;
            document.getElementById("saddr2").value = billObject.addressLine2;
            document.getElementById("scity").value = billObject.city;
            document.getElementById("sstate").value = billObject.state;
            document.getElementById("szipcode").value = billObject.zipcode;
            document.getElementById("scountry").value = billObject.country;
    }
            
  
    function populateProductTable(products, classes) {
        var cols = Object.keys(products[0]);
        var headerRow = '';
        var bodyRows = '';
        classes = classes || '';

        function capitalizeFirstLetter(string) {
            return string.charAt(0).toUpperCase() + string.slice(1);
        }

        cols.map(function (col) {
            headerRow += '<th>' + capitalizeFirstLetter(col) + '</th>';
        });
        
        

         products.map(function (row) {
            bodyRows += '<tr id='+row.productId+'>';
            cols.map(function (colName) {
                switch (colName) {
                    case "productId":
                        bodyRows += '<td>' + '<input required type="number" value=' + row[colName] + " id=productId" + row.productId + ">" + '</td>';
                        break;
                    case "unitPrice":
                        bodyRows += '<td>' + '<input required type="number" value=' + row[colName] + " id="+row.productName+row.productId +" onchange=calculatePrice(this.value,document.getElementById('"+"count"+row.productName + row.productId+"').value,totalPrice"+row.productId+")>" + '</td>';
                        break;
                    case "totalPrice":
                        bodyRows += '<td>' + '<input class="totalPrice" type="number" readonly value=' + row[colName] + " id='totalPrice"+row.productId+"'>" + '</td>';
                        break;
                    case "productCount":
                        bodyRows += '<td>' + '<input required type="number" value=' + row[colName]+ " id="+"count"+row.productName + row.productId+" onchange=calculatePrice(this.value,document.getElementById('"+row.productName+row.productId +"').value,totalPrice" + row.productId + ")>" + '</td>';
                        break;   
                    case "notes":
                        bodyRows += '<td>' + '<textarea value=' + row[colName] + "></textarea>" + '</td>';
                        break;
                    case "productName":
                        bodyRows += '<td>' + '<input required type="text" value=' + row[colName] + " id=productName" + row.productId + ">" + '</td>';
                        break;
                    default:
                        break;
                }
            })

            bodyRows +='<td>'+'<button class="button delBtn" onclick = "deleteProduct(this)">'+"DELETE" +'</button></td >';

            bodyRows += '</tr>';
        });


        return '<table class="' +
            classes +
            '"><thead><tr>' +
            headerRow +
            '</tr></thead><tbody>' +
            bodyRows +
            '</tbody></table>';
    }

    function calculatePrice(val, val1, id) {
            var totalPrice = val*val1;
            document.getElementById(id.id).value = totalPrice;
    }

    // function validateFields() {
    //         var flag = true;
    //         var requiredElements = document.getElementById("myTable").querySelectorAll("[required]");
    //         var billdate = document.getElementById("bdate").value;
    //         var shipdate = document.getElementById("sdate").value;

    //         if (billdate == "") {
    //             console.log("enter Bill Date");
    //             flag = false;
    //         }
    //         else {
    //             flag = true;
    //         }

    //         if (shipdate == "") {
    //             console.log("enter Bill Date");
    //         }

    //         for (var i = 0; i < requiredElements.length; i++) {
    //             var e = requiredElements[i];
    //             console.log(requiredElements[i].id);
    //             if (!e.value) {
    //                 flag = false;
    //                 document.getElementById(requiredElements[i].id).classList.add("errorClass");
    //             }
    //             // else {
    //             //     document.getElementById(requiredElements[i].id).classList.remove("errorClass");
    //             // }

    //         }

    //     }



    function submitProducts() {

        var flag = true;
        var requiredElements = document.getElementById("myTable").querySelectorAll("[required]");
        var billdate = document.getElementById("bdate").value;
        var shipdate = document.getElementById("sdate").value;
        

        if(billdate == "" || shipdate == ""){
           
            document.getElementById("uniqueId").innerHTML = "Please Enter Date To Proceed Further";
            document.getElementById("uniqueId").classList.add("errorClass");
            flag = false;
        }
        else {
            document.getElementById("uniqueId").innerHTML = "";
            document.getElementById("uniqueId").classList.remove("errorClass");
        }

        
        var myTable = document.getElementById("myTable");
        var currentIndex = myTable.rows.length - 1;
        var productIdArray = [];
        for (var i = 1; i <= currentIndex; i++) {
            if(productIdArray.includes(myTable.rows[i].cells[0].getElementsByTagName("input")[0].value)){
               document.getElementById("uniqueId").innerHTML = "Please Enter Unique Product Id";
               document.getElementById("uniqueId").classList.add("errorClass");
               flag = false;
               
            }
            else {
                productIdArray.push(myTable.rows[i].cells[0].getElementsByTagName("input")[0].value);
                document.getElementById("uniqueId").classList.remove("errorClass");
            }

            
        }
        console.log(productIdArray);

        for (var i = 0; i < requiredElements.length; i++) {
            var e = requiredElements[i];            
            if (e.value == "") {
                flag = false;
                document.getElementById(requiredElements[i].id).classList.add("errorClass");
            }
            else {
                document.getElementById(requiredElements[i].id).classList.remove("errorClass");
            }

        }

       

        if (flag) {
            console.log("json submitted");
            generateJSON();
        }
        else {
            console.log("not submitted");
        }

    }
    

   
</script>

</html>
